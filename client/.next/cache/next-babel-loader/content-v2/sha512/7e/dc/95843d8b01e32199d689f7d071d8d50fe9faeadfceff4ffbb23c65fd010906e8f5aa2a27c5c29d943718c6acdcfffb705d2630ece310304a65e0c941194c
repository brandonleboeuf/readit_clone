{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/bleb/DEV/personal/projects for CODE page/readit_clone/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/bleb/DEV/personal/projects for CODE page/readit_clone/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createRef, useState, useEffect } from 'react';\nimport dayjs from 'dayjs';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\nimport useSWR from 'swr';\nimport Axios from 'axios';\nimport classNames from 'classnames';\nimport PostCard from '../../components/PostCard';\nimport { useAuthState } from '../../context/auth';\nexport default function user() {\n  var router = useRouter();\n  var username = router.query.username;\n\n  var _useState = useState(false),\n      ownSub = _useState[0],\n      setOwnSub = _useState[1];\n\n  var _useAuthState = useAuthState(),\n      authenticated = _useAuthState.authenticated,\n      user = _useAuthState.user;\n\n  var fileInputRef = /*#__PURE__*/createRef();\n\n  var _useSWR = useSWR(username ? \"/users/\".concat(username) : null),\n      data = _useSWR.data,\n      error = _useSWR.error,\n      revalidate = _useSWR.revalidate;\n\n  if (error) router.push('/');\n  useEffect(function () {\n    if (!data) return;\n    setOwnSub(authenticated && (user.username === data.user.username || user.username === 'brandon'));\n  }, [data]);\n\n  var openFileInput = function openFileInput() {\n    if (!ownSub) return;\n    fileInputRef.current.name = 'profileImageUrl';\n    fileInputRef.current.click();\n  };\n\n  var uploadImage = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var file, formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              file = event.target.files[0];\n              formData = new FormData();\n              formData.append('file', file);\n              formData.append('type', fileInputRef.current.name);\n              console.log(formData);\n              _context.prev = 5;\n              _context.next = 8;\n              return Axios.post(\"/users/\".concat(data.user.username, \"/image\"), formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 8:\n              revalidate();\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](5);\n              console.log(_context.t0);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[5, 11]]);\n    }));\n\n    return function uploadImage(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: data === null || data === void 0 ? void 0 : data.user.username\n      })\n    }), data && /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: uploadImage\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container flex pt-5\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"w-160\",\n          children: data.submissions.map(function (submission) {\n            if (submission.type === 'Post') {\n              var post = submission;\n              return /*#__PURE__*/_jsx(PostCard, {\n                post: post\n              }, post.identifier);\n            } else {\n              var comment = submission;\n              return /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex my-4 bg-white rounded\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \"flex-shrink-0 w-10 py-4 text-center bg-gray-200 rounded-l\",\n                  children: /*#__PURE__*/_jsx(\"i\", {\n                    className: \"text-gray-500 fas fa-comment-alt fa-xs\"\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"w-full p-2\",\n                  children: [/*#__PURE__*/_jsxs(\"p\", {\n                    className: \"mb-2 text-xs text-gray-500\",\n                    children: [comment.username, /*#__PURE__*/_jsx(\"span\", {\n                      children: \" commented on \"\n                    }), /*#__PURE__*/_jsx(Link, {\n                      href: comment.post.url,\n                      children: /*#__PURE__*/_jsx(\"a\", {\n                        className: \"font-semibold curser-pointer hover:underline\",\n                        children: comment.post.title\n                      })\n                    }), /*#__PURE__*/_jsx(\"span\", {\n                      className: \"mx-1\",\n                      children: \"\\u2022\"\n                    }), /*#__PURE__*/_jsx(Link, {\n                      href: \"/r/\".concat(comment.post.subName),\n                      children: /*#__PURE__*/_jsxs(\"a\", {\n                        className: \"text-black curser-pointer hover:underline\",\n                        children: [\"/r/\", comment.post.subName]\n                      })\n                    })]\n                  }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsx(\"p\", {\n                    children: comment.body\n                  })]\n                })]\n              }, comment.identifier);\n            }\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"ml-6 w-80\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"bg-white rounded\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"items-center p-3 rounded-t\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: data.user.profileImageUrl,\n                alt: \"user profile\",\n                className: classNames('mx-auto rounded', {\n                  'cursor-pointer': ownSub\n                }),\n                onClick: function onClick() {\n                  return openFileInput();\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"p-3 text-center\",\n              children: [/*#__PURE__*/_jsx(\"h1\", {\n                className: \"mb-3 text-xl\",\n                children: data.user.username\n              }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsxs(\"p\", {\n                className: \"mt-3\",\n                children: [\"Joined \", dayjs(data.user.createdAt).format('MMM YYYY')]\n              })]\n            })]\n          })\n        })]\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}