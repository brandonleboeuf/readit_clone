{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/bleb/DEV/personal/projects for CODE page/readit_clone/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/bleb/DEV/personal/projects for CODE page/readit_clone/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createRef, useEffect, useState } from 'react';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport useSWR from 'swr';\nimport PostCard from '../../components/PostCard';\nimport Image from 'next/image';\nimport classNames from 'classnames';\nimport { useAuthState } from '../../context/auth';\nimport Axios from 'axios';\nimport Sidebar from '../../components/Sidebar';\nexport default function SubPage() {\n  // Local state\n  var _useState = useState(false),\n      ownSub = _useState[0],\n      setOwnSub = _useState[1]; // Global state\n\n\n  var _useAuthState = useAuthState(),\n      authenticated = _useAuthState.authenticated,\n      user = _useAuthState.user; // Utils\n\n\n  var router = useRouter();\n  var fileInputRef = /*#__PURE__*/createRef();\n  var subName = router.query.sub;\n\n  var _useSWR = useSWR(subName ? \"/subs/\".concat(subName) : null),\n      sub = _useSWR.data,\n      error = _useSWR.error,\n      revalidate = _useSWR.revalidate; // console.log({ sub: sub })\n  // console.log({ subposts: sub.posts })\n\n\n  useEffect(function () {\n    if (!sub) return;\n    setOwnSub(authenticated && (user.username === sub.username || user.username === 'brandon'));\n  }, [sub]);\n\n  var openFileInput = function openFileInput(type) {\n    if (!ownSub) return;\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  var uploadImage = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var file, formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              file = event.target.files[0];\n              formData = new FormData();\n              formData.append('file', file);\n              formData.append('type', fileInputRef.current.name);\n              _context.prev = 4;\n              _context.next = 7;\n              return Axios.post(\"/subs/\".concat(sub.name, \"/image\"), formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 7:\n              revalidate();\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](4);\n              console.log(_context.t0);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 10]]);\n    }));\n\n    return function uploadImage(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (error) router.push('/');\n  var postsMarkup;\n\n  if (!sub) {\n    postsMarkup = /*#__PURE__*/_jsx(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"Loading..\"\n    });\n  } else if (sub.posts.length === 0) {\n    postsMarkup = /*#__PURE__*/_jsx(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"No posts submitted yet\"\n    });\n  } else {\n    postsMarkup = sub.posts.map(function (post) {\n      return /*#__PURE__*/_jsx(PostCard, {\n        post: post,\n        revalidate: revalidate\n      }, post.identifier);\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: sub === null || sub === void 0 ? void 0 : sub.title\n      })\n    }), sub && /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: uploadImage\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: classNames('bg-blue-500', {\n            'cursor-pointer': ownSub\n          }),\n          onClick: function onClick() {\n            return openFileInput('banner');\n          },\n          children: sub.bannerUrl ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"h-56 bg-blue-500\",\n            style: {\n              backgroundImage: \"url(\".concat(sub.bannerUrl, \")\"),\n              backgroundRepeat: 'no-repeat',\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }\n          }) : /*#__PURE__*/_jsx(\"div\", {\n            className: \"h-20 bg-blue-500\"\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"h-20 bg-white\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"container relative flex\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"absolute\",\n              style: {\n                top: -15\n              },\n              children: /*#__PURE__*/_jsx(Image, {\n                src: sub.imageUrl,\n                alt: \"Sub\",\n                className: classNames('rounded-full', {\n                  'cursor-pointer': ownSub\n                }),\n                onClick: function onClick() {\n                  return openFileInput('image');\n                },\n                width: 70,\n                height: 70\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"pt-2 pl-24\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"flex items-center\",\n                children: /*#__PURE__*/_jsx(\"h1\", {\n                  className: \"mb-1 text-3xl font-bold\",\n                  children: sub.title\n                })\n              }), /*#__PURE__*/_jsxs(\"p\", {\n                className: \"text-sm font-bold text-gray-600\",\n                children: [\"/r/\", sub.name]\n              })]\n            })]\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container flex pt-4\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"w-160\",\n          children: postsMarkup\n        }), /*#__PURE__*/_jsx(Sidebar, {\n          sub: sub\n        })]\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}